#!/bin/bash

if [[ $EUID > 0 ]]
	then echo "Permession denied: this incident will be reported."
	exit
fi

mkdir -p /tmp/kernelbuild
cd /tmp/kernelbuild

wget https://www.kernel.org/pub/linux/kernel/v4.x/linux-${1}.tar.xz
tar xvfJ linux-${1}.tar.xz

cd linux-${1}
make clean && make mrproper

zcat /proc/config.gz > .config
make nconfig

make -j4
make -j4 modules_install

VER=$(echo ${1} | cut -d. -f-2 | sed 's/\.//')
cp -v arch/x86_64/boot/bzImage /boot/vmlinuz-linux${VER}
sed 's/__VER__/${VER}/' /etc/mkinitcpio.d/linuxgen > /etc/mkinitcpio.d/linux${VER}.preset
mkinitcpio -p linux${VER}

cp System.map /boot/System.map-linux${VER}
ln -sf /boot/System.map-linux${VAR} /boot/System.map

echo "Now just update the bootloader"

